# Render Monorepo Deployment Guide - AgentGuard

**Mothership AI - Enterprise AI Safety Platform**  
**Product:** watcher.mothership-ai.com  
**Version:** 1.0.0  
**Date:** October 25, 2025

---

## Overview

This guide provides complete instructions for deploying AgentGuard as a monorepo to Render.com, with both backend API and frontend UI deployed from a single repository.

**Deployment Architecture:**
- Single GitHub repository
- Two Render services (backend + frontend)
- Automatic service discovery and linking
- Zero-downtime deployments
- Production-ready configuration

---

## Prerequisites

### Required Accounts
1. GitHub account with repository access
2. Render.com account (free tier available)
3. API keys for AI providers (optional for initial deployment)

### Repository Requirements
- Repository: `mars` (current repository)
- Branch: `main`
- Access: Public or private with Render GitHub integration

---

## Repository Structure

```
mars/
├── render.yaml                 # Render configuration (monorepo)
├── requirements-render.txt     # Backend dependencies
├── runtime.txt                 # Python version (3.13.0)
├── src/                        # Backend source code
│   └── api/
│       └── main.py            # FastAPI application
├── agentguard-ui/             # Frontend application
│   ├── package.json           # Node dependencies
│   ├── next.config.js         # Next.js configuration
│   ├── app/                   # Next.js app directory
│   └── public/                # Static assets
└── docs/                      # Documentation
```

---

## Deployment Steps

### Step 1: Connect GitHub Repository to Render

1. Log in to Render Dashboard: https://dashboard.render.com
2. Click "New +" → "Blueprint"
3. Select "Connect a repository"
4. Authorize Render to access your GitHub account
5. Select repository: `seanebones-lang/mars`
6. Branch: `main`
7. Click "Apply"

**Render will automatically:**
- Detect `render.yaml` configuration
- Create two services: `agentguard-api` and `agentguard-ui`
- Link services together (API URL → Frontend)
- Start initial deployment

---

### Step 2: Configure Backend Service (agentguard-api)

#### Service Configuration (Auto-configured from render.yaml)
- **Name:** agentguard-api
- **Environment:** Python
- **Runtime:** python-3.13.0
- **Region:** Oregon (us-west)
- **Plan:** Starter ($7/month)
- **Root Directory:** `.` (repository root)
- **Build Command:** `pip install --upgrade pip && pip install -r requirements-render.txt`
- **Start Command:** `uvicorn src.api.main:app --host 0.0.0.0 --port $PORT --workers 2`
- **Health Check:** `/health`

#### Required Environment Variables

**Set in Render Dashboard → agentguard-api → Environment:**

```bash
# Required
ENVIRONMENT=production
LOG_LEVEL=INFO
DEBUG=false

# AI Provider API Keys (at least one required)
CLAUDE_API_KEY=sk-ant-api03-...          # Anthropic Claude
OPENAI_API_KEY=sk-...                    # OpenAI GPT
GOOGLE_API_KEY=...                       # Google Gemini (optional)

# Security (auto-generated by Render)
JWT_SECRET=<auto-generated>
API_KEY_SECRET=<auto-generated>

# Database (optional - uses SQLite if not provided)
DATABASE_URL=postgresql://user:pass@host:5432/dbname

# Redis (optional - caching disabled if not provided)
REDIS_URL=redis://user:pass@host:6379/0

# CORS (will be updated after frontend deployment)
CORS_ORIGINS=*

# Feature Flags
ENABLE_MULTIMODAL=true
ENABLE_BIAS_AUDITING=true
ENABLE_RED_TEAMING=true
ENABLE_COMPLIANCE_REPORTING=true
```

#### Deployment Process
1. Render builds backend from `requirements-render.txt`
2. Installs Python 3.13.0 and dependencies
3. Starts FastAPI application with Uvicorn
4. Health check validates `/health` endpoint
5. Service becomes available at: `https://agentguard-api.onrender.com`

---

### Step 3: Configure Frontend Service (agentguard-ui)

#### Service Configuration (Auto-configured from render.yaml)
- **Name:** agentguard-ui
- **Environment:** Node
- **Runtime:** Node 20.x (auto-detected)
- **Region:** Oregon (us-west)
- **Plan:** Starter ($7/month)
- **Root Directory:** `agentguard-ui`
- **Build Command:** `npm install && npm run build`
- **Start Command:** `npm start`
- **Health Check:** `/`

#### Environment Variables (Auto-configured)

```bash
# API Connection (automatically linked to backend service)
NEXT_PUBLIC_API_URL=https://agentguard-api.onrender.com

# Application Configuration
NEXT_PUBLIC_APP_NAME=AgentGuard
NEXT_PUBLIC_APP_VERSION=1.0.0
NEXT_PUBLIC_APP_DESCRIPTION=AI Safety Platform - Production Ready

# Company Information
NEXT_PUBLIC_SUPPORT_EMAIL=info@mothership-ai.com
NEXT_PUBLIC_COMPANY_NAME=Mothership AI
NEXT_PUBLIC_COMPANY_URL=https://mothership-ai.com
NEXT_PUBLIC_DOMAIN=watcher.mothership-ai.com

# Feature Flags
NEXT_PUBLIC_ENABLE_ANALYTICS=true
NEXT_PUBLIC_ENABLE_MONITORING=true
NEXT_PUBLIC_ENABLE_WEBHOOKS=true
NEXT_PUBLIC_ENABLE_BATCH_PROCESSING=true

# Security
NEXT_PUBLIC_ENABLE_HTTPS_ONLY=true
NEXT_PUBLIC_ENABLE_SECURITY_HEADERS=true
```

#### Deployment Process
1. Render navigates to `agentguard-ui` directory
2. Runs `npm install` to install dependencies
3. Runs `npm run build` to create production build
4. Starts Next.js production server with `npm start`
5. Service becomes available at: `https://agentguard-ui.onrender.com`

---

### Step 4: Update CORS Configuration

After frontend deployment, update backend CORS settings:

1. Go to Render Dashboard → agentguard-api → Environment
2. Update `CORS_ORIGINS` variable:
   ```
   CORS_ORIGINS=https://agentguard-ui.onrender.com,https://watcher.mothership-ai.com
   ```
3. Click "Save Changes"
4. Service will automatically redeploy

---

### Step 5: Configure Custom Domains (Optional)

#### Backend API Domain
1. Go to Render Dashboard → agentguard-api → Settings
2. Scroll to "Custom Domains"
3. Click "Add Custom Domain"
4. Enter: `api.watcher.mothership-ai.com`
5. Add DNS records to your domain provider:
   ```
   Type: CNAME
   Name: api.watcher
   Value: agentguard-api.onrender.com
   ```
6. Wait for SSL certificate provisioning (automatic)

#### Frontend UI Domain
1. Go to Render Dashboard → agentguard-ui → Settings
2. Scroll to "Custom Domains"
3. Click "Add Custom Domain"
4. Enter: `watcher.mothership-ai.com`
5. Add DNS records to your domain provider:
   ```
   Type: CNAME
   Name: watcher
   Value: agentguard-ui.onrender.com
   ```
6. Wait for SSL certificate provisioning (automatic)

#### Update Environment Variables After Custom Domains
1. Backend CORS:
   ```
   CORS_ORIGINS=https://watcher.mothership-ai.com
   ```
2. Frontend API URL (if using custom backend domain):
   ```
   NEXT_PUBLIC_API_URL=https://api.watcher.mothership-ai.com
   ```

---

## Verification Steps

### Backend API Verification

#### Health Check
```bash
curl https://agentguard-api.onrender.com/health
```

**Expected Response:**
```json
{
  "status": "healthy",
  "version": "1.0.0",
  "timestamp": "2025-10-25T12:00:00Z"
}
```

#### API Documentation
Visit: `https://agentguard-api.onrender.com/docs`

**Expected:** Interactive Swagger UI with all API endpoints

#### Test Endpoint
```bash
curl -X POST https://agentguard-api.onrender.com/api/v1/analyze \
  -H "Content-Type: application/json" \
  -H "X-API-Key: your_api_key" \
  -d '{
    "text": "The Eiffel Tower is located in London.",
    "model": "claude-3-5-sonnet-20241022"
  }'
```

**Expected:** JSON response with hallucination detection results

---

### Frontend UI Verification

#### Homepage
Visit: `https://agentguard-ui.onrender.com`

**Expected:** AgentGuard landing page loads successfully

#### Dashboard
Visit: `https://agentguard-ui.onrender.com/dashboard`

**Expected:** Dashboard interface loads (may require authentication)

#### API Connection Test
1. Open browser console (F12)
2. Navigate to dashboard
3. Check Network tab for API calls to backend
4. Verify successful responses from `agentguard-api.onrender.com`

#### Performance Check
Run Lighthouse audit:
```bash
npx lighthouse https://agentguard-ui.onrender.com --view
```

**Expected Scores:**
- Performance: 90+
- Accessibility: 95+
- Best Practices: 95+
- SEO: 95+

---

## Monitoring and Logs

### Backend Logs
1. Go to Render Dashboard → agentguard-api → Logs
2. View real-time application logs
3. Filter by log level (INFO, WARNING, ERROR)
4. Download logs for analysis

### Frontend Logs
1. Go to Render Dashboard → agentguard-ui → Logs
2. View build and runtime logs
3. Monitor Next.js server output
4. Check for errors or warnings

### Metrics
1. Go to Render Dashboard → Service → Metrics
2. Monitor:
   - CPU usage
   - Memory usage
   - Request count
   - Response times
   - Error rates

---

## Troubleshooting

### Backend Issues

#### Issue: Build Fails
**Symptoms:** Deployment fails during pip install

**Solutions:**
1. Check `requirements-render.txt` for syntax errors
2. Verify Python version in `runtime.txt` (should be `python-3.13.0`)
3. Check Render logs for specific error messages
4. Ensure all dependencies are compatible with Python 3.13

#### Issue: Health Check Fails
**Symptoms:** Service shows as unhealthy

**Solutions:**
1. Verify `/health` endpoint exists in `src/api/main.py`
2. Check that application starts successfully (view logs)
3. Ensure port binding is correct: `--port $PORT`
4. Increase health check initial delay in `render.yaml`

#### Issue: API Returns 500 Errors
**Symptoms:** API endpoints return internal server errors

**Solutions:**
1. Check environment variables are set correctly
2. Verify AI provider API keys are valid
3. Check database connection (if using external database)
4. Review application logs for stack traces

---

### Frontend Issues

#### Issue: Build Fails
**Symptoms:** npm run build fails

**Solutions:**
1. Check `package.json` for correct dependencies
2. Verify Node version compatibility
3. Check for TypeScript errors
4. Review build logs for specific errors

#### Issue: Blank Page
**Symptoms:** Frontend loads but shows blank page

**Solutions:**
1. Check browser console for JavaScript errors
2. Verify `NEXT_PUBLIC_API_URL` is set correctly
3. Check CORS configuration on backend
4. Ensure Next.js build completed successfully

#### Issue: API Calls Fail
**Symptoms:** Frontend can't connect to backend

**Solutions:**
1. Verify `NEXT_PUBLIC_API_URL` environment variable
2. Check CORS settings on backend include frontend URL
3. Verify backend service is running and healthy
4. Check network tab in browser for failed requests

---

## Automatic Deployments

### Git Push Deployments
Every push to `main` branch triggers automatic deployment:

1. Push code to GitHub:
   ```bash
   git add .
   git commit -m "Update feature"
   git push origin main
   ```

2. Render automatically:
   - Detects changes
   - Starts build process
   - Runs health checks
   - Switches traffic to new version
   - Zero downtime deployment

### Deployment Notifications
Configure in Render Dashboard → Service → Settings → Notifications:
- Email notifications
- Slack webhooks
- Discord webhooks
- Custom webhooks

---

## Rollback Procedure

### Manual Rollback
1. Go to Render Dashboard → Service → Events
2. Find previous successful deployment
3. Click "Rollback to this deploy"
4. Confirm rollback
5. Service reverts to previous version

### Git-Based Rollback
```bash
# Revert to previous commit
git revert HEAD
git push origin main

# Or reset to specific commit
git reset --hard <commit-hash>
git push origin main --force
```

---

## Scaling Configuration

### Vertical Scaling (Upgrade Plan)
1. Go to Render Dashboard → Service → Settings
2. Change plan:
   - **Starter:** $7/month (512MB RAM, 0.5 CPU)
   - **Standard:** $25/month (2GB RAM, 1 CPU)
   - **Pro:** $85/month (4GB RAM, 2 CPU)
   - **Pro Plus:** $200/month (8GB RAM, 4 CPU)

### Horizontal Scaling (Multiple Instances)
Available on Pro plans and above:
1. Go to Service → Settings → Scaling
2. Increase instance count (1-10)
3. Load balancer automatically distributes traffic
4. Cost = Plan price × Instance count

---

## Cost Optimization

### Current Configuration
- **Backend (Starter):** $7/month
- **Frontend (Starter):** $7/month
- **Total:** $14/month

### Free Tier Option
Render offers free tier with limitations:
- Services spin down after 15 minutes of inactivity
- Cold start time: 30-60 seconds
- 750 hours/month free (per service)
- Suitable for development/staging

### Production Recommendations
- **Minimum:** Starter plan for both services ($14/month)
- **Recommended:** Standard plan for backend ($25/month) + Starter for frontend ($7/month) = $32/month
- **High Traffic:** Pro plan for both services ($170/month)

---

## Security Checklist

- [ ] Environment variables set securely (no hardcoded secrets)
- [ ] HTTPS enforced (automatic with Render)
- [ ] CORS configured correctly
- [ ] Security headers enabled (configured in next.config.js)
- [ ] API keys rotated regularly
- [ ] Database credentials secured
- [ ] Health checks configured
- [ ] Monitoring and alerting enabled
- [ ] Custom domains with SSL (optional)
- [ ] Rate limiting configured (via Cloudflare)

---

## Performance Optimization

### Backend Optimizations
- Workers: 2 (configured in start command)
- Keep-alive connections enabled
- Redis caching (if configured)
- Database connection pooling
- Response compression enabled

### Frontend Optimizations
- Static asset caching
- Image optimization (Next.js built-in)
- Code splitting (automatic)
- CDN integration (Cloudflare recommended)
- Standalone output mode (smaller Docker images)

---

## Maintenance

### Regular Tasks

#### Weekly
- Review application logs
- Check error rates
- Monitor resource usage
- Verify health checks passing

#### Monthly
- Update dependencies (security patches)
- Review and rotate API keys
- Check SSL certificate status
- Analyze performance metrics
- Review and optimize costs

#### Quarterly
- Major dependency updates
- Security audit
- Performance optimization review
- Disaster recovery drill
- Backup verification

---

## Support and Resources

### Render Documentation
- Main Docs: https://render.com/docs
- Blueprint Spec: https://render.com/docs/blueprint-spec
- Environment Variables: https://render.com/docs/environment-variables
- Custom Domains: https://render.com/docs/custom-domains

### AgentGuard Resources
- Main Documentation: `/docs`
- API Documentation: `https://agentguard-api.onrender.com/docs`
- GitHub Repository: https://github.com/seanebones-lang/mars

### Contact
- **Email:** info@mothership-ai.com
- **Website:** https://mothership-ai.com
- **Product:** https://watcher.mothership-ai.com

---

## Deployment Checklist

### Pre-Deployment
- [ ] GitHub repository connected to Render
- [ ] `render.yaml` configuration verified
- [ ] Environment variables prepared
- [ ] API keys obtained (Claude, OpenAI, etc.)
- [ ] Database provisioned (if using external)
- [ ] Redis provisioned (if using external)

### Deployment
- [ ] Backend service deployed successfully
- [ ] Frontend service deployed successfully
- [ ] Services linked correctly (API URL)
- [ ] CORS configuration updated
- [ ] Health checks passing
- [ ] Custom domains configured (optional)
- [ ] SSL certificates active

### Post-Deployment
- [ ] Backend API verified (health check, docs, test endpoint)
- [ ] Frontend UI verified (homepage, dashboard, API connection)
- [ ] Monitoring configured
- [ ] Logging verified
- [ ] Performance tested
- [ ] Security headers validated
- [ ] Automatic deployments tested
- [ ] Rollback procedure tested

---

## Conclusion

AgentGuard is now deployed as a monorepo on Render with:
- **Backend API:** FastAPI 0.120.0, Python 3.13.0, PostgreSQL 18, Redis 8.0.4
- **Frontend UI:** Next.js 16.0.0, React 19.2.0, TypeScript 5.9.3
- **Deployment:** Zero-downtime, automatic from Git
- **Monitoring:** Real-time logs and metrics
- **Security:** HTTPS, CORS, security headers, environment secrets
- **Scalability:** Vertical and horizontal scaling available
- **Cost:** Starting at $14/month (both services)

**Production-ready and enterprise-grade deployment complete.**

---

**Document Version:** 1.0  
**Date:** October 25, 2025  
**Author:** Sean McDonnell, Chief Engineer  
**Team:** Mothership AI Engineering

---

**Mothership AI**  
Enterprise AI Safety & Governance Platform  
[mothership-ai.com](https://mothership-ai.com) • [watcher.mothership-ai.com](https://watcher.mothership-ai.com) • [info@mothership-ai.com](mailto:info@mothership-ai.com)

